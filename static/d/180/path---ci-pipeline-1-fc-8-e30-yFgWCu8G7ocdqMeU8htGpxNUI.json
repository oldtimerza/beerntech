{"data":{"site":{"siteMetadata":{"title":"Oldtimerza.js","author":"Bradley Morris"}},"markdownRemark":{"id":"1387915e-d502-5c26-9bc5-a26fbbf9b49b","excerpt":"Introduction One of the best ways to get a project up and running and making it easy to have the project be live and testable as soon as possible\nis to start…","html":"<h2>Introduction</h2>\n<p>One of the best ways to get a project up and running and making it easy to have the project be live and testable as soon as possible\nis to start development with a <strong>Continuous Integration(CI)</strong> pipeline.</p>\n<p><strong>Continuous Integration</strong>,from here on referred to as <strong>CI</strong>, is the process of having an automated process compile, test and deploy the project whenever a code change is detected in the\nrepository.</p>\n<p>For the purpose of this blog I will describe how to get a simple CI pipeline up and running for a node js based project.</p>\n<p>The technologies we’ll be using are the following:</p>\n<ul>\n<li><strong>Github</strong>, The popular free source control host and tooling.</li>\n<li><strong>CircleCI</strong>, A service that you can hook into your <strong>Github</strong> repo that will pull the latest code changes and run them through a configurable process.</li>\n<li><strong>Docker</strong>, Containerisation. This isn’t too important to know what it is, but it helps us with keeping our deployment environment predictable and stable.</li>\n<li><strong>DockerHub</strong>, A free store to host our <strong>Docker</strong> images to enable the transfer of our production code.</li>\n<li><strong>Digital Ocean</strong>, A service that hosts Virtual Private servers that we need to host our project in the cloud.</li>\n</ul>\n<h2>Step 1: Setup</h2>\n<p>What we need to setup:</p>\n<ul>\n<li>A github repo.</li>\n<li>Circle ci and connect to our Github repo.</li>\n<li>Setup a digital ocean droplet.</li>\n<li>A Circle ci config file (.circleci/config.yml).</li>\n<li>A docker image file to create our docker image for deployment.</li>\n</ul>\n<h3>Github repo</h3>\n<p>For the purpose of this tutorial I’ll be using the following repository I have for an existing project:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/45a8fa48aebf2fa66af1fd182be6a861/aac1f/github-repo.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 53.30396475770925%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABOElEQVQoz4WRTU8CMRCG+cMGBFkgi8A/82jizbMHD5IoAdltO51+Ttcpu2R1E3XyHvoxT2fe6Wi13i3X22W5LVab+fK+KHezRTmeFpPZYsyaFjeTu6xb1py3rThnVW5GzTUSEaJVJqKNKTWsJuXzSEQptWp+xihdg5OkBq0BNNRSClBoDWiLxgcfkk/k6PJOH33lGH1Vv7OMrZyrra2J1Ol0ftsfDx/V48vzw+vToHgPW+ePlZY6VMoJ8AIcWwAbMRA6OoDYy89B4z3sQzyr3JlUqhZSSJWblxBijIliJNR26Pk7XIPnhdao4OJeax9CN86U0Ji/YNHCiFJB5kF738GU/+J3OARSGNIV5rJorDE2XYz+A7MrbpszGW5RznbOM9bB5k/4rDx/BnNc2fL0Qx5Wd0vEjw7gL5hLZlD4WQgbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Github repo\"\n        title=\"\"\n        src=\"/static/45a8fa48aebf2fa66af1fd182be6a861/fb8a0/github-repo.png\"\n        srcset=\"/static/45a8fa48aebf2fa66af1fd182be6a861/1a291/github-repo.png 148w,\n/static/45a8fa48aebf2fa66af1fd182be6a861/2bc4a/github-repo.png 295w,\n/static/45a8fa48aebf2fa66af1fd182be6a861/fb8a0/github-repo.png 590w,\n/static/45a8fa48aebf2fa66af1fd182be6a861/526de/github-repo.png 885w,\n/static/45a8fa48aebf2fa66af1fd182be6a861/fa2eb/github-repo.png 1180w,\n/static/45a8fa48aebf2fa66af1fd182be6a861/08f6a/github-repo.png 1770w,\n/static/45a8fa48aebf2fa66af1fd182be6a861/aac1f/github-repo.png 1816w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Creating a Github account, if you don’t have one, and creating a repo should be pretty easy to setup.\nWe’ll skip this setup stage.</p>\n<h3>Connect Circle CI to our repo</h3>\n<p>First follow the steps on this page [https://circleci.com/docs/2.0/getting-started/]: <a href=\"https://circleci.com/docs/2.0/getting-started/\">https://circleci.com/docs/2.0/getting-started/</a></p>\n<blockquote>\n<p>Be sure to create the .circleci/config.yml file and push it to your repo.</p>\n</blockquote>\n<p>Once your Github account is connected to your github repo we’ll change the newly created config.yml to get our circleci workflow to build, test and deploy the project to digital ocean.\nNext we’ll setup an SSH key that we’ll later use to connect to our Digital Ocean droplet for deployment.</p>\n<h3>Playing with PuTTy</h3>\n<p>I assume you are using a windows machine, this tutorial will focus on developing on a windows machine, we will use a niffty app called PuTTy to generate our SSH key.</p>\n<p>Download PuTTY from here:\n[https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html]<a href=\"https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html\">https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html</a></p>\n<h3>Create a Digital Ocean droplet</h3>\n<p>Head on over to Digital Ocean and create an account.\nOnce you’ve logged in create a Droplet(the smallest $5 one should be fine for the purposes of this tutorial).</p>\n<p>When you’ve created your droplet there is one more thing we need to do with it before we are done with Digital Ocean for now.</p>\n<p>We need to create and get the SSH details to later login and deploy our docker image.</p>\n<p>To do this go to the following page:\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/90e31f839e9197ca79c08d3b0b1c4343/9446b/digital-ocean-dash.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.818828680897646%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABgklEQVQoz31RS0sCURQeitq0bKFI7fsF/YSgrNat+wlCwvjCH+EPcCJGBxKih0KoLUSQHtCqXSSuFEKZmfuce2/TmRkzwezjcu85nMf33XO0ta3jeuvJ931Kqe9Lfwm+wpsofvHZmyh6c3XdvX3TtndPm51XCAyxunxnyHVc10UIeZ632MLj3CNUSRW5mhZPNtrPYI0J7/QdRghIEEIEbAuQUkJIKRWJ0dZ3ThrtF7DlT78Ig8EA+KMWy/6irSSO6q2AeTgalY1zs2JVKlXTNEulUrlsVKuBO4NlWYZh9Ho9yAd+bTVxWG8+gvPR76fTZ5mMnstlAcVisVDIR3Y2m9F1HZ58Pp9KpWq12rRYiyUbD7+yl0r8U/ZmbK951wGLe8LFBGHCInBBKIPDGEyQjSfBCggJotOBQfFGfP++0Q2L5cQmYxtjKkJXORjqRTTgiRP0AMzPD2QfRLIZlw6GJI+yoDHcDuI2YkJIyEeEg5gZ51xxuCqgQsSzXexi+s965vENFapACS7y8A0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Digital Ocean Dashboard\"\n        title=\"\"\n        src=\"/static/90e31f839e9197ca79c08d3b0b1c4343/fb8a0/digital-ocean-dash.png\"\n        srcset=\"/static/90e31f839e9197ca79c08d3b0b1c4343/1a291/digital-ocean-dash.png 148w,\n/static/90e31f839e9197ca79c08d3b0b1c4343/2bc4a/digital-ocean-dash.png 295w,\n/static/90e31f839e9197ca79c08d3b0b1c4343/fb8a0/digital-ocean-dash.png 590w,\n/static/90e31f839e9197ca79c08d3b0b1c4343/526de/digital-ocean-dash.png 885w,\n/static/90e31f839e9197ca79c08d3b0b1c4343/fa2eb/digital-ocean-dash.png 1180w,\n/static/90e31f839e9197ca79c08d3b0b1c4343/08f6a/digital-ocean-dash.png 1770w,\n/static/90e31f839e9197ca79c08d3b0b1c4343/9446b/digital-ocean-dash.png 1827w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>When you are on your dashboard you’ll see your droplet there(mine is called blade-express-docker-1)\nYou now need to click on the <strong>Securtiy</strong> option on the sidebar near the bottom.</p>\n<p>This will take you to the following screen:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/02c0de28d5ebdf90fab87e7f05ea14ab/98ef2/digital-ocean-security.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 49.14506343077772%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABc0lEQVQoz2WRy0rDQBSGgxsrgerGKi68QYtF6Rv4AmJR1Fasuvf5usiiq276AGIvVpGoFXpZBJsmc5+JJ5lRG/0ZAjOZ75zz/2NlC1V75+y+8xJFESGEcy6lVEpF/6Si+LAdfDhB96X/XC6XrUyxtlK8bPde4Qdgs9nM9/3xeDwYDGA7DwslqeIy+q1r2fkLu1DVsBASISSEcF232WxSSudhJsWUI48FSMTnMJ2VK91kS7cPPVd3JgSHCOmejLE/RrBkgSQwgumc279a2jxpP8adKWNBEMJVaA5MynCimMfY96cGXj2o2bvnP3AYxrBWq9Wq1+uNRsNxnMlkEvuSgguJialrLWwcL26dahgAzpn4zsnzvOFwOBqN4Euo8UkpATsG3ju8Wy9dd5/edWBT34fMoARo/sESH4ww5X2GGGEDZ/OV5UKl039LppKUxbdoIkJgYUIFogpTiYjiIvXylrV2lNk2YwMAYYBtlVKkl1Sp5EBfo+oRwrfp9DsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Digital Ocean security\"\n        title=\"\"\n        src=\"/static/02c0de28d5ebdf90fab87e7f05ea14ab/fb8a0/digital-ocean-security.png\"\n        srcset=\"/static/02c0de28d5ebdf90fab87e7f05ea14ab/1a291/digital-ocean-security.png 148w,\n/static/02c0de28d5ebdf90fab87e7f05ea14ab/2bc4a/digital-ocean-security.png 295w,\n/static/02c0de28d5ebdf90fab87e7f05ea14ab/fb8a0/digital-ocean-security.png 590w,\n/static/02c0de28d5ebdf90fab87e7f05ea14ab/526de/digital-ocean-security.png 885w,\n/static/02c0de28d5ebdf90fab87e7f05ea14ab/fa2eb/digital-ocean-security.png 1180w,\n/static/02c0de28d5ebdf90fab87e7f05ea14ab/08f6a/digital-ocean-security.png 1770w,\n/static/02c0de28d5ebdf90fab87e7f05ea14ab/98ef2/digital-ocean-security.png 1813w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Click on the <strong>Add SSH Key</strong> button on the right.\nThat will bring up the next popup:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> circleci/node<span class=\"token punctuation\">:</span><span class=\"token number\">8</span>\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">NODE_ENV</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'test'</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> checkout\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">restore_cache</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> dependency<span class=\"token punctuation\">-</span>cache<span class=\"token punctuation\">-</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> checksum \"package.json\" <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install Dependencies\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> yarn install <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>production=false\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">save_cache</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> dependency<span class=\"token punctuation\">-</span>cache<span class=\"token punctuation\">-</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> checksum \"package.json\" <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> ./node_modules\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Test\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> yarn test\n  <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> circleci/node<span class=\"token punctuation\">:</span><span class=\"token number\">7</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> checkout\n      <span class=\"token punctuation\">-</span> setup_remote_docker\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy image to Docker Hub\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            docker build --build-arg DOCKER_USER=$DOCKER_USER --build-arg DOCKER_PASSWORD=$DOCKER_PASSWORD -t oldtimerza/blade-express .\n            docker login -u $DOCKER_USER -p $DOCKER_PASSWORD\n            docker push oldtimerza/blade-express</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run docker image on Digital Ocean Droplet\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            ssh $SSH_USER@$SSH_HOST -o StrictHostKeyChecking=no 'docker stop app &amp;&amp; docker rm $(docker ps -a -q) &amp;&amp; docker rmi $(docker images -q) &amp;&amp; docker pull oldtimerza/blade-express &amp;&amp; docker run -d -t -p 80:3000 --name app oldtimerza/blade-express'</span>\n\n<span class=\"token key atrule\">workflows</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n  <span class=\"token key atrule\">build-deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> build\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">requires</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> build\n          <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">only</span><span class=\"token punctuation\">:</span> master</code></pre></div>","frontmatter":{"title":"Simple CI pipeline","date":"January 19, 2019"}}},"pageContext":{"slug":"/ci-pipeline-1/","previous":{"fields":{"slug":"/hi-folks/"},"frontmatter":{"title":"New Beginnings"}},"next":null}}